<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>file_formats.gnucash_xml &mdash; gnewcash 1.0alpha documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=9974cacb"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            gnewcash
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Using GNewCash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_documentation.html">Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gnewcash</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">file_formats.gnucash_xml</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for file_formats.gnucash_xml</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module containing the logic for loading and saving XML files.</span>

<span class="sd">.. module:: xml</span>
<span class="sd">   :synopsis:</span>
<span class="sd">.. moduleauthor: Paul Bromwell Jr.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>

<span class="kn">from</span> <span class="nn">gnewcash.account</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="kn">from</span> <span class="nn">gnewcash.commodity</span> <span class="kn">import</span> <span class="n">Commodity</span>
<span class="kn">from</span> <span class="nn">gnewcash.file_formats.base</span> <span class="kn">import</span> <span class="n">BaseFileFormat</span><span class="p">,</span> <span class="n">BaseFileReader</span><span class="p">,</span> <span class="n">BaseFileWriter</span>
<span class="kn">from</span> <span class="nn">gnewcash.gnucash_file</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Budget</span><span class="p">,</span> <span class="n">GnuCashFile</span>
<span class="kn">from</span> <span class="nn">gnewcash.slot</span> <span class="kn">import</span> <span class="n">Slot</span>
<span class="kn">from</span> <span class="nn">gnewcash.transaction</span> <span class="kn">import</span> <span class="n">ScheduledTransaction</span><span class="p">,</span> <span class="n">SortingMethod</span><span class="p">,</span> <span class="n">Split</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">,</span> <span class="n">TransactionManager</span>
<span class="kn">from</span> <span class="nn">gnewcash.utils</span> <span class="kn">import</span> <span class="n">safe_iso_date_formatting</span><span class="p">,</span> <span class="n">safe_iso_date_parsing</span>

<span class="n">XML_NAMESPACES</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gnc&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/gnc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;act&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/act&#39;</span><span class="p">,</span>
    <span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/book&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/cd&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cmdty&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/cmdty&#39;</span><span class="p">,</span>
    <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/price&#39;</span><span class="p">,</span>
    <span class="s1">&#39;slot&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/slot&#39;</span><span class="p">,</span>
    <span class="s1">&#39;split&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/split&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sx&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/sx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;trn&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/trn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/ts&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fs&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/fs&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bgt&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/bgt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;recurrence&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/recurrence&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lot&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/lot&#39;</span><span class="p">,</span>
    <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/addr&#39;</span><span class="p">,</span>
    <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/owner&#39;</span><span class="p">,</span>
    <span class="s1">&#39;billterm&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/billterm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bt-days&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/bt-days&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bt-prox&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/bt-prox&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cust&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/cust&#39;</span><span class="p">,</span>
    <span class="s1">&#39;employee&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/employee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/entry&#39;</span><span class="p">,</span>
    <span class="s1">&#39;invoice&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/invoice&#39;</span><span class="p">,</span>
    <span class="s1">&#39;job&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/job&#39;</span><span class="p">,</span>
    <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/order&#39;</span><span class="p">,</span>
    <span class="s1">&#39;taxtable&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/taxtable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tte&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/tte&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.gnucash.org/XML/vendor&#39;</span>
<span class="p">}</span>


<div class="viewcode-block" id="GnuCashXMLReader">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader">[docs]</a>
<span class="k">class</span> <span class="nc">GnuCashXMLReader</span><span class="p">(</span><span class="n">BaseFileReader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing the logic for loading XML files.&quot;&quot;&quot;</span>

    <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

<div class="viewcode-block" id="GnuCashXMLReader.load">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.load">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
            <span class="n">source_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">sort_transactions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">sort_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SortingMethod</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GnuCashFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a GnuCash XML file from disk to memory.</span>

<span class="sd">        :param source_file: File to load from disk</span>
<span class="sd">        :type source_file: str</span>
<span class="sd">        :param sort_transactions: Should transactions be sorted by date posted</span>
<span class="sd">        :type sort_transactions: bool</span>
<span class="sd">        :param sort_method: SortMethod class instance that determines the sort order for the transactions</span>
<span class="sd">        :type sort_method: SortingMethod</span>
<span class="sd">        :return: GnuCashFile object</span>
<span class="sd">        :rtype: GnuCashFile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">built_file</span><span class="p">:</span> <span class="n">GnuCashFile</span> <span class="o">=</span> <span class="n">GnuCashFile</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_file</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No file provided to load&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">built_file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">source_file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">built_file</span>

        <span class="n">built_file</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">source_file</span><span class="o">.</span><span class="n">name</span>

        <span class="n">root</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_xml_root</span><span class="p">(</span><span class="n">source_file</span><span class="p">)</span>

        <span class="n">books</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:book&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
            <span class="n">new_book</span><span class="p">:</span> <span class="n">Book</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_book_from_xml</span><span class="p">(</span><span class="n">book</span><span class="p">,</span>
                                                      <span class="n">sort_transactions</span><span class="o">=</span><span class="n">sort_transactions</span><span class="p">,</span>
                                                      <span class="n">sort_method</span><span class="o">=</span><span class="n">sort_method</span><span class="p">)</span>
            <span class="n">built_file</span><span class="o">.</span><span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_book</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">built_file</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.get_xml_root">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.get_xml_root">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_xml_root</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the root element from a given XML document.</span>

<span class="sd">        :param source_path: Path to XML document</span>
<span class="sd">        :type source_path: pathlib.Path</span>
<span class="sd">        :return: Root element</span>
<span class="sd">        :rtype: ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">source_path</span><span class="p">))</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_book_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_book_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_book_from_xml</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">book_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
            <span class="n">sort_transactions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">sort_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SortingMethod</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Book</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Book object from the GnuCash XML.</span>

<span class="sd">        :param book_node: XML node for the book</span>
<span class="sd">        :type book_node: ElementTree.Element</span>
<span class="sd">        :param sort_transactions: Flag for if transactions should be sorted by date_posted when reading from XML</span>
<span class="sd">        :type sort_transactions: bool</span>
<span class="sd">        :param sort_method: SortingMethod class instance that determines the sort order for the transactions.</span>
<span class="sd">        :type sort_method: SortingMethod</span>
<span class="sd">        :return: Book object from XML</span>
<span class="sd">        :rtype: Book</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_book</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span>
        <span class="n">book_id_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;book:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">book_id_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">book_id_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">new_book</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">book_id_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:account&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">transactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:transaction&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">slots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;book:slots&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">slots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">):</span>
                <span class="n">new_book</span><span class="o">.</span><span class="n">slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_slot_from_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="n">commodities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:commodity&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">commodities</span><span class="p">:</span>
            <span class="n">new_book</span><span class="o">.</span><span class="n">commodities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_commodity_from_xml</span><span class="p">(</span><span class="n">commodity</span><span class="p">))</span>

        <span class="n">account_objects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Account</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">transaction_manager</span><span class="p">:</span> <span class="n">TransactionManager</span> <span class="o">=</span> <span class="n">TransactionManager</span><span class="p">(</span><span class="n">disable_sort</span><span class="o">=</span><span class="ow">not</span> <span class="n">sort_transactions</span><span class="p">,</span>
                                                                     <span class="n">sort_method</span><span class="o">=</span><span class="n">sort_method</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
            <span class="n">account_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_account_from_xml</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">account_objects</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">:</span>
            <span class="n">transaction_manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_transaction_from_xml</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">account_objects</span><span class="p">))</span>

        <span class="n">new_book</span><span class="o">.</span><span class="n">root_account</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">account_objects</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;ROOT&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_book</span><span class="o">.</span><span class="n">transactions</span> <span class="o">=</span> <span class="n">transaction_manager</span>

        <span class="n">template_transactions_xml</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:template-transactions&#39;</span><span class="p">,</span>
                                                                                           <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">template_transactions_xml</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Account</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">template_transactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Transaction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">template_transaction</span> <span class="ow">in</span> <span class="n">template_transactions_xml</span><span class="p">:</span>
                <span class="c1"># Process accounts before transactions</span>
                <span class="k">for</span> <span class="n">subelement</span> <span class="ow">in</span> <span class="n">template_transaction</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">subelement</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">template_accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_account_from_xml</span><span class="p">(</span><span class="n">subelement</span><span class="p">,</span> <span class="n">template_accounts</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">subelement</span> <span class="ow">in</span> <span class="n">template_transaction</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">subelement</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;transaction&#39;</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">template_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_transaction_from_xml</span><span class="p">(</span><span class="n">subelement</span><span class="p">,</span> <span class="n">template_accounts</span><span class="p">))</span>
            <span class="n">new_book</span><span class="o">.</span><span class="n">template_transactions</span> <span class="o">=</span> <span class="n">template_transactions</span>
            <span class="n">template_root_accounts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Account</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">template_accounts</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;ROOT&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">template_root_accounts</span><span class="p">:</span>
                <span class="n">new_book</span><span class="o">.</span><span class="n">template_root_account</span> <span class="o">=</span> <span class="n">template_root_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">scheduled_transactions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:schedxaction&#39;</span><span class="p">,</span>
                                                                                        <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scheduled_transaction</span> <span class="ow">in</span> <span class="n">scheduled_transactions</span><span class="p">:</span>
                <span class="n">new_book</span><span class="o">.</span><span class="n">scheduled_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">create_scheduled_transaction_from_xml</span><span class="p">(</span><span class="n">scheduled_transaction</span><span class="p">,</span> <span class="n">new_book</span><span class="o">.</span><span class="n">template_root_account</span><span class="p">))</span>

        <span class="n">budgets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]]</span> <span class="o">=</span> <span class="n">book_node</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;gnc:budget&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">budgets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">budget</span> <span class="ow">in</span> <span class="n">budgets</span><span class="p">:</span>
                <span class="n">new_book</span><span class="o">.</span><span class="n">budgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_budget_from_xml</span><span class="p">(</span><span class="n">budget</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">new_book</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_slot_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_slot_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_slot_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">slot_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Slot</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Slot object from the GnuCash XML.</span>

<span class="sd">        :param slot_node: XML node for the slot</span>
<span class="sd">        :type slot_node: ElementTree.Element</span>
<span class="sd">        :return: Slot object from XML</span>
<span class="sd">        :rtype: Slot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">slot_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;slot:key&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">key_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;slot:key missing or empty in slot node&#39;</span><span class="p">)</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">key_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">value_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">slot_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;slot:value&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;slot:value missing in slot node&#39;</span><span class="p">)</span>
        <span class="n">slot_type</span> <span class="o">=</span> <span class="n">value_node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">slot_type</span> <span class="o">==</span> <span class="s1">&#39;gdate&#39;</span><span class="p">:</span>
            <span class="n">value_gdate_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;gdate&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_gdate_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;slot type is gdate but missing gdate node&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_gdate_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;slot type is gdate but gdate node is empty&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value_gdate_node</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">slot_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value_node</span><span class="o">.</span><span class="n">text</span>
        <span class="k">elif</span> <span class="n">slot_type</span> <span class="o">==</span> <span class="s1">&#39;integer&#39;</span> <span class="ow">and</span> <span class="n">value_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">slot_type</span> <span class="o">==</span> <span class="s1">&#39;double&#39;</span> <span class="ow">and</span> <span class="n">value_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_tags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">value_node</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">child_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;slot&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_slot_from_xml</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value_node</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">slot_type</span> <span class="o">==</span> <span class="s1">&#39;frame&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Empty frame element, just leave it</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Slot type </span><span class="si">{</span><span class="n">slot_type</span><span class="si">}</span><span class="s1"> is not implemented.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Slot</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">slot_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_commodity_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_commodity_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_commodity_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">commodity_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Commodity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Commodity object from the GnuCash XML.</span>

<span class="sd">        :param commodity_node: XML node for the commodity</span>
<span class="sd">        :type commodity_node: ElementTree.Element</span>
<span class="sd">        :return: Commodity object from XML</span>
<span class="sd">        :rtype: Commodity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commodity_id_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity_id_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">commodity_id_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Commodity node is missing id&#39;</span><span class="p">)</span>
        <span class="n">commodity_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">commodity_id_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">commodity_space_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:space&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity_space_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">commodity_space_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Commodity node is missing space&#39;</span><span class="p">)</span>
        <span class="n">space</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">commodity_space_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">new_commodity</span><span class="p">:</span> <span class="n">Commodity</span> <span class="o">=</span> <span class="n">Commodity</span><span class="p">(</span><span class="n">commodity_id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:get_quotes&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_commodity</span><span class="o">.</span><span class="n">get_quotes</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">quote_source_node</span> <span class="o">=</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:quote_source&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quote_source_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_commodity</span><span class="o">.</span><span class="n">quote_source</span> <span class="o">=</span> <span class="n">quote_source_node</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;quote_tz&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_commodity</span><span class="o">.</span><span class="n">quote_tz</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">name_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:name&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_commodity</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">xcode_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:xcode&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xcode_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_commodity</span><span class="o">.</span><span class="n">xcode</span> <span class="o">=</span> <span class="n">xcode_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">fraction_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">commodity_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:fraction&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fraction_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_commodity</span><span class="o">.</span><span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction_node</span><span class="o">.</span><span class="n">text</span>

        <span class="k">return</span> <span class="n">new_commodity</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_account_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_account_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_account_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">account_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">account_objects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Account</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Account</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an Account object from the GnuCash XML.</span>

<span class="sd">        :param account_node: XML node for the account</span>
<span class="sd">        :type account_node: ElementTree.Element</span>
<span class="sd">        :param account_objects: Account objects already created from XML (used for assigning parent account)</span>
<span class="sd">        :type account_objects: list[Account]</span>
<span class="sd">        :return: Account object from XML</span>
<span class="sd">        :rtype: Account</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">account_object</span><span class="p">:</span> <span class="n">Account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">()</span>
        <span class="n">account_guid_node</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">account_guid_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">account_guid_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Account guid node is missing or empty&#39;</span><span class="p">)</span>
        <span class="n">account_object</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">account_guid_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">account_name_node</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:name&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">account_name_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">account_name_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">account_name_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">account_type_node</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:type&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">account_type_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">account_type_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">account_type_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">commodity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:commodity&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">commodity</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">commodity</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_commodity_from_xml</span><span class="p">(</span><span class="n">commodity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">commodity</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">commodity_scu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:commodity-scu&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity_scu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">commodity_scu</span> <span class="o">=</span> <span class="n">commodity_scu</span><span class="o">.</span><span class="n">text</span>

        <span class="n">slots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:slots&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">):</span>
                <span class="n">account_object</span><span class="o">.</span><span class="n">slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_slot_from_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="n">code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:code&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">text</span>

        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:description&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">text</span>

        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;act:parent&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">account_object</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">account_objects</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">guid</span> <span class="o">==</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">account_object</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_transaction_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_transaction_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_transaction_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">transaction_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
                                    <span class="n">account_objects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Account</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Transaction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Transaction object from the GnuCash XML.</span>

<span class="sd">        :param transaction_node: XML node for the transaction</span>
<span class="sd">        :type transaction_node: ElementTree.Element</span>
<span class="sd">        :param account_objects: Account objects already created from XML (used for assigning accounts)</span>
<span class="sd">        :type account_objects: list[Account]</span>
<span class="sd">        :return: Transaction object from XML</span>
<span class="sd">        :rtype: Transaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transaction</span><span class="p">:</span> <span class="n">Transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">()</span>
        <span class="n">guid_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">guid_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">guid_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">transaction</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">guid_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">date_entered_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:date-entered&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">date_entered_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_entered_ts_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_entered_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ts:date&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date_entered_ts_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">date_entered_ts_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">transaction</span><span class="o">.</span><span class="n">date_entered</span> <span class="o">=</span> <span class="n">safe_iso_date_parsing</span><span class="p">(</span><span class="n">date_entered_ts_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">date_posted_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:date-posted&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">date_posted_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_posted_ts_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_posted_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ts:date&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date_posted_ts_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">date_posted_ts_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">transaction</span><span class="o">.</span><span class="n">date_posted</span> <span class="o">=</span> <span class="n">safe_iso_date_parsing</span><span class="p">(</span><span class="n">date_posted_ts_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">description_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:description&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">description_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">description_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">transaction</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">memo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:num&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transaction</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="n">memo</span><span class="o">.</span><span class="n">text</span>

        <span class="n">currency_node</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:currency&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">currency_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">currency_id_node</span> <span class="o">=</span> <span class="n">currency_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="n">currency_space_node</span> <span class="o">=</span> <span class="n">currency_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;cmdty:space&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">currency_id_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">currency_space_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                    <span class="ow">and</span> <span class="n">currency_id_node</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">currency_space_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">transaction</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">Commodity</span><span class="p">(</span><span class="n">currency_id_node</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                                                 <span class="n">currency_space_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">slots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:slots&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">):</span>
                <span class="n">transaction</span><span class="o">.</span><span class="n">slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_slot_from_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="n">splits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;trn:splits&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">splits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">splits</span><span class="p">):</span>
                <span class="n">transaction</span><span class="o">.</span><span class="n">splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_split_from_xml</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">account_objects</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">transaction</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_split_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_split_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_split_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">split_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">account_objects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Account</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Split</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an Split object from the GnuCash XML.</span>

<span class="sd">        :param split_node: XML node for the split</span>
<span class="sd">        :type split_node: ElementTree.Element</span>
<span class="sd">        :param account_objects: Account objects already created from XML (used for assigning parent account)</span>
<span class="sd">        :type account_objects: list[Account]</span>
<span class="sd">        :return: Split object from XML</span>
<span class="sd">        :rtype: Split</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">account_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:account&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">account_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">account_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid or missing split:account node&#39;</span><span class="p">)</span>
        <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">value_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:value&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid or missing split:value node&#39;</span><span class="p">)</span>
        <span class="n">value_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">value_node</span><span class="o">.</span><span class="n">text</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value_str</span><span class="p">[:</span><span class="n">value_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)])</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value_str</span><span class="p">[</span><span class="n">value_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

        <span class="n">reconciled_state_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:reconciled-state&#39;</span><span class="p">,</span>
                                                                               <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reconciled_state_node</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">reconciled_state_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid or missing split:reconciled-state node&#39;</span><span class="p">)</span>
        <span class="n">new_split</span> <span class="o">=</span> <span class="n">Split</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">account_objects</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">guid</span> <span class="o">==</span> <span class="n">account</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">value</span><span class="p">,</span> <span class="n">reconciled_state_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">guid_node</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">guid_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">guid_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">new_split</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">guid_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">split_memo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:memo&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">split_memo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_split</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="n">split_memo</span><span class="o">.</span><span class="n">text</span>

        <span class="n">split_action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:action&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">split_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_split</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">split_action</span><span class="o">.</span><span class="n">text</span>

        <span class="n">quantity_node</span> <span class="o">=</span> <span class="n">split_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;split:quantity&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quantity_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quantity</span> <span class="o">=</span> <span class="n">quantity_node</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">quantity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">quantity</span><span class="p">:</span>
                <span class="n">new_split</span><span class="o">.</span><span class="n">quantity_denominator</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">new_split</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_scheduled_transaction_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_scheduled_transaction_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_scheduled_transaction_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">xml_obj</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span>
                                              <span class="n">template_account_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Account</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ScheduledTransaction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a ScheduledTransaction object from the GnuCash XML.</span>

<span class="sd">        :param xml_obj: XML node for the scheduled transaction</span>
<span class="sd">        :type xml_obj: ElementTree.Element</span>
<span class="sd">        :param template_account_root: Root template account</span>
<span class="sd">        :type template_account_root: Account</span>
<span class="sd">        :return: ScheduledTransaction object from XML</span>
<span class="sd">        :rtype: ScheduledTransaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_obj</span><span class="p">:</span> <span class="s1">&#39;ScheduledTransaction&#39;</span> <span class="o">=</span> <span class="n">ScheduledTransaction</span><span class="p">()</span>
        <span class="n">sx_transaction_guid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_text</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sx_transaction_guid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sx_transaction_guid</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">sx_transaction_guid</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_text</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:name&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_boolean</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:enabled&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">auto_create</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_boolean</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:autoCreate&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">auto_create_notify</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_boolean</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:autoCreateNotify&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">advance_create_days</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_int</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:advanceCreateDays&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">advance_remind_days</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_int</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:advanceRemindDays&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">instance_count</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_int</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:instanceCount&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_date</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:start&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">last_date</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_date</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:last&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="n">new_obj</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_date</span><span class="p">(</span><span class="n">xml_obj</span><span class="p">,</span> <span class="s1">&#39;sx:end&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>

        <span class="n">template_account_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml_obj</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;sx:templ-acct&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">template_account_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">template_account_node</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">template_account_root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">template_account</span> <span class="o">=</span> <span class="n">template_account_root</span><span class="o">.</span><span class="n">get_subaccount_by_id</span><span class="p">(</span><span class="n">template_account_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">schedule_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml_obj</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;sx:schedule&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schedule_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recurrence_node</span> <span class="o">=</span> <span class="n">schedule_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;gnc:recurrence&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recurrence_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">recurrence_multiplier</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_int</span><span class="p">(</span>
                    <span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:mult&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span>
                <span class="p">)</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">recurrence_period</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_text</span><span class="p">(</span>
                    <span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:period_type&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">recurrence_start</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_date</span><span class="p">(</span>
                    <span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:start&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_obj</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.create_budget_from_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.create_budget_from_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_budget_from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">budget_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Budget</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Budget object from the GnuCash XML.</span>

<span class="sd">        :param budget_node: XML node for the budget</span>
<span class="sd">        :type budget_node: ElementTree.Element</span>
<span class="sd">        :return: Budget object from XML</span>
<span class="sd">        :rtype: Budget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_obj</span> <span class="o">=</span> <span class="n">Budget</span><span class="p">()</span>

        <span class="n">id_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;bgt:id&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">id_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">id_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="n">id_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">name_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;bgt:name&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">description_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;bgt:description&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">description_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description_node</span><span class="o">.</span><span class="n">text</span>

        <span class="n">period_count_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;bgt:num-periods&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period_count_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">period_count_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">period_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">period_count_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">recurrence_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;bgt:recurrence&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recurrence_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">multiplier_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">recurrence_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;recurrence:mult&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">multiplier_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">multiplier_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">recurrence_multiplier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">multiplier_node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="n">period_type_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">recurrence_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;recurrence:period_type&#39;</span><span class="p">,</span>
                                                                                   <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">period_type_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">recurrence_period_type</span> <span class="o">=</span> <span class="n">period_type_node</span><span class="o">.</span><span class="n">text</span>

            <span class="n">recurrence_start_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">recurrence_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;recurrence:start&#39;</span><span class="p">,</span>
                                                                                        <span class="n">XML_NAMESPACES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recurrence_start_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">gdate_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">recurrence_start_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;gdate&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gdate_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gdate_node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">new_obj</span><span class="o">.</span><span class="n">recurrence_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">gdate_node</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">slots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;bgt:slots&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">,</span> <span class="n">XML_NAMESPACES</span><span class="p">):</span>
                <span class="n">new_obj</span><span class="o">.</span><span class="n">slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">create_slot_from_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">new_obj</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.read_xml_child_text">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.read_xml_child_text">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_xml_child_text</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">xml_object</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">namespaces</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the text from a specific child XML element.</span>

<span class="sd">        :param xml_object: Current XML object</span>
<span class="sd">        :type xml_object: ElementTree.Element</span>
<span class="sd">        :param tag_name: Child tag name</span>
<span class="sd">        :type tag_name: str</span>
<span class="sd">        :param namespaces: GnuCash namespaces</span>
<span class="sd">        :type namespaces: dict[str, str]</span>
<span class="sd">        :return: Child node&#39;s text</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml_object</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_node</span><span class="o">.</span><span class="n">text</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.read_xml_child_boolean">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.read_xml_child_boolean">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_xml_child_boolean</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">xml_object</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">namespaces</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the text from a specific child XML element and returns a Boolean if the text is &quot;Y&quot; or &quot;y&quot;.</span>

<span class="sd">        :param xml_object: Current XML object</span>
<span class="sd">        :type xml_object: ElementTree.Element</span>
<span class="sd">        :param tag_name: Child tag name</span>
<span class="sd">        :type tag_name: str</span>
<span class="sd">        :param namespaces: GnuCash namespaces</span>
<span class="sd">        :type namespaces: dict[str, str]</span>
<span class="sd">        :return: True if child node&#39;s text is &quot;Y&quot; or &quot;Y&quot;, otherwise False.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_text</span><span class="p">(</span><span class="n">xml_object</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node_text</span> <span class="ow">and</span> <span class="n">node_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">node_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.read_xml_child_int">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.read_xml_child_int">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_xml_child_int</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">xml_object</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">namespaces</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the text from a specific child XML element and returns its text as an integer value.</span>

<span class="sd">        :param xml_object: Current XML object</span>
<span class="sd">        :type xml_object: ElementTree.Element</span>
<span class="sd">        :param tag_name: Child tag name</span>
<span class="sd">        :type tag_name: str</span>
<span class="sd">        :param namespaces: GnuCash namespaces</span>
<span class="sd">        :type namespaces: dict[str, str]</span>
<span class="sd">        :return: Child&#39;s text as an integer value</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_xml_child_text</span><span class="p">(</span><span class="n">xml_object</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">node_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GnuCashXMLReader.read_xml_child_date">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLReader.read_xml_child_date">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_xml_child_date</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">xml_object</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">namespaces</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the text from a specific child XML element and returns its inner gdate text as a datetime.</span>

<span class="sd">        :param xml_object: Current XML object</span>
<span class="sd">        :type xml_object: ElementTree.Element</span>
<span class="sd">        :param tag_name: Child tag name</span>
<span class="sd">        :type tag_name: str</span>
<span class="sd">        :param namespaces: GnuCash namespaces</span>
<span class="sd">        :type namespaces: dict[str, str]</span>
<span class="sd">        :return: Child&#39;s gdate&#39;s text as datetime</span>
<span class="sd">        :rtype: datetime.datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml_object</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">date_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;gdate&#39;</span><span class="p">,</span> <span class="n">namespaces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">date_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_node</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">date_node</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="GnuCashXMLWriter">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter">[docs]</a>
<span class="k">class</span> <span class="nc">GnuCashXMLWriter</span><span class="p">(</span><span class="n">BaseFileWriter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing the logic for saving XML files.&quot;&quot;&quot;</span>

    <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

<div class="viewcode-block" id="GnuCashXMLWriter.dump">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.dump">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">gnucash_file</span><span class="p">:</span> <span class="n">GnuCashFile</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">target_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
             <span class="n">prettify_xml</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes GnuCash XML file from memory to disk.</span>

<span class="sd">        :param gnucash_file: File to write to disk</span>
<span class="sd">        :type gnucash_file: GnuCashFile</span>
<span class="sd">        :param target_file: Destination file to write to.</span>
<span class="sd">        :type target_file: str</span>
<span class="sd">        :param prettify_xml: Should the XML be prettified? (default false)</span>
<span class="sd">        :type prettify_xml: bool</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span>
            <span class="s1">&#39;gnc-v2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;xmlns:&#39;</span> <span class="o">+</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">XML_NAMESPACES</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="n">book_count_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:count-data&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cd:type&#39;</span><span class="p">:</span> <span class="s1">&#39;book&#39;</span><span class="p">})</span>
        <span class="n">book_count_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gnucash_file</span><span class="o">.</span><span class="n">books</span><span class="p">))</span>
        <span class="n">root_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">book_count_node</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">gnucash_file</span><span class="o">.</span><span class="n">books</span><span class="p">:</span>
            <span class="n">root_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_book_as_xml</span><span class="p">(</span><span class="n">book</span><span class="p">))</span>

        <span class="n">file_contents</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">root_node</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;xml&#39;</span><span class="p">)</span>

        <span class="c1"># Making our resulting XML pretty</span>
        <span class="k">if</span> <span class="n">prettify_xml</span><span class="p">:</span>
            <span class="n">file_contents</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">write_file_contents</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">file_contents</span><span class="p">)</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_book_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_book_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_book_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">book</span><span class="p">:</span> <span class="n">Book</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current book as GnuCash-compatible XML.</span>

<span class="sd">        :return: ElementTree.Element object</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">book_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:book&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">})</span>
        <span class="n">book_id_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;book:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span>
        <span class="n">book_id_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">guid</span>

        <span class="n">accounts_xml</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="p">:</span>
            <span class="n">accounts_xml</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cast_account_as_xml</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">root_account</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
            <span class="n">slot_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;book:slots&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
                <span class="n">slot_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_slot_as_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="n">commodity_count_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;gnc:count-data&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cd:type&#39;</span><span class="p">:</span> <span class="s1">&#39;commodity&#39;</span><span class="p">})</span>
        <span class="n">commodity_count_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">commodity_id</span> <span class="o">!=</span> <span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">commodities</span><span class="p">))))</span>

        <span class="n">account_count_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;gnc:count-data&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cd:type&#39;</span><span class="p">:</span> <span class="s1">&#39;account&#39;</span><span class="p">})</span>
        <span class="n">account_count_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">accounts_xml</span><span class="p">)</span> <span class="k">if</span> <span class="n">accounts_xml</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">transaction_count_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;gnc:count-data&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cd:type&#39;</span><span class="p">:</span> <span class="s1">&#39;transaction&#39;</span><span class="p">})</span>
        <span class="n">transaction_count_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">transactions</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">scheduled_transactions</span><span class="p">:</span>
            <span class="n">scheduled_transaction_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;gnc:count-data&#39;</span><span class="p">,</span>
                                                                <span class="p">{</span><span class="s1">&#39;cd:type&#39;</span><span class="p">:</span> <span class="s1">&#39;schedxaction&#39;</span><span class="p">})</span>
            <span class="n">scheduled_transaction_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">scheduled_transactions</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">budgets</span><span class="p">:</span>
            <span class="n">budget_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;gnc:count-data&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cd:type&#39;</span><span class="p">:</span> <span class="s1">&#39;budget&#39;</span><span class="p">})</span>
            <span class="n">budget_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">budgets</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">commodity</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">commodities</span><span class="p">:</span>
            <span class="n">book_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_commodity_as_xml</span><span class="p">(</span><span class="n">commodity</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">accounts_xml</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts_xml</span><span class="p">:</span>
                <span class="n">book_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">transactions</span><span class="p">:</span>
            <span class="n">book_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_transaction_as_xml</span><span class="p">(</span><span class="n">transaction</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">template_root_account</span> <span class="ow">and</span> <span class="n">book</span><span class="o">.</span><span class="n">template_transactions</span><span class="p">:</span>
            <span class="n">template_transactions_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">book_node</span><span class="p">,</span> <span class="s1">&#39;gnc:template-transactions&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cast_account_as_xml</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">template_root_account</span><span class="p">):</span>
                <span class="n">template_transactions_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">template_transactions</span><span class="p">:</span>
                <span class="n">template_transactions_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_transaction_as_xml</span><span class="p">(</span><span class="n">transaction</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">scheduled_transaction</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">scheduled_transactions</span><span class="p">:</span>
            <span class="n">book_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_scheduled_transaction_as_xml</span><span class="p">(</span><span class="n">scheduled_transaction</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">budget</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">budgets</span><span class="p">:</span>
            <span class="n">book_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_budget_as_xml</span><span class="p">(</span><span class="n">budget</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">book_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_account_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_account_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_account_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current account configuration (and all of its child accounts) as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current account and children as XML</span>
<span class="sd">        :rtype: list[xml.etree.ElementTree.Element]</span>
<span class="sd">        :raises: ValueError if no commodity found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_and_children</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">account_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:account&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">})</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">name</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">guid</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">commodity</span><span class="p">:</span>
            <span class="n">account_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_commodity_as_short_xml</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">commodity</span><span class="p">,</span> <span class="s1">&#39;act:commodity&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_commodity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Commodity</span><span class="p">]</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">get_parent_commodity</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">parent_commodity</span><span class="p">:</span>
                <span class="n">account_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_commodity_as_short_xml</span><span class="p">(</span><span class="n">parent_commodity</span><span class="p">,</span> <span class="s1">&#39;act:commodity&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">commodity_scu</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:commodity-scu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">commodity_scu</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">code</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:description&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
            <span class="n">slots_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:slots&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">account</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
                <span class="n">slots_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_slot_as_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">account_node</span><span class="p">,</span> <span class="s1">&#39;act:parent&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">guid</span>
        <span class="n">node_and_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">account_node</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">account</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">node_and_children</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cast_account_as_xml</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">node_and_children</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_slot_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_slot_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_slot_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">:</span> <span class="n">Slot</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current slot as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current slot as XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slot_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">)</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">slot_node</span><span class="p">,</span> <span class="s1">&#39;slot:key&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">key</span>

        <span class="n">slot_value_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">slot_node</span><span class="p">,</span> <span class="s1">&#39;slot:value&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">slot</span><span class="o">.</span><span class="n">type</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;gdate&#39;</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">slot_value_node</span><span class="p">,</span> <span class="s1">&#39;gdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">slot</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">slot</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">]:</span>
            <span class="n">slot_value_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="n">slot</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">]:</span>
            <span class="n">slot_value_node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">slot</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slot</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_slot</span> <span class="ow">in</span> <span class="n">slot</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">slot_value_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_slot_as_xml</span><span class="p">(</span><span class="n">sub_slot</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">slot</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;frame&#39;</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Empty frame element, just leave it</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Slot type </span><span class="si">{</span><span class="n">slot</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s1"> is not implemented.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">slot_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_commodity_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_commodity_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_commodity_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">commodity</span><span class="p">:</span> <span class="n">Commodity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current commodity as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current commodity as XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commodity_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:commodity&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">})</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:space&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">space</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">commodity_id</span>
        <span class="k">if</span> <span class="n">commodity</span><span class="o">.</span><span class="n">get_quotes</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:get_quotes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity</span><span class="o">.</span><span class="n">quote_source</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:quote_source&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">quote_source</span>
        <span class="k">if</span> <span class="n">commodity</span><span class="o">.</span><span class="n">quote_tz</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:quote_tz&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">commodity</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">commodity</span><span class="o">.</span><span class="n">xcode</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:xcode&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">xcode</span>
        <span class="k">if</span> <span class="n">commodity</span><span class="o">.</span><span class="n">fraction</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">fraction</span>

        <span class="k">return</span> <span class="n">commodity_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_commodity_as_short_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_commodity_as_short_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_commodity_as_short_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">commodity</span><span class="p">:</span> <span class="n">Commodity</span><span class="p">,</span> <span class="n">node_tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current commodity as GnuCash-compatible XML (short version used for accounts).</span>

<span class="sd">        :param commodity: Commodity being cast to short XML</span>
<span class="sd">        :type commodity: Commodity</span>
<span class="sd">        :param node_tag: XML element tag name for the commodity</span>
<span class="sd">        :type node_tag: str</span>
<span class="sd">        :return: Current commodity as short XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">commodity_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">node_tag</span><span class="p">)</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:space&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">space</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">commodity_node</span><span class="p">,</span> <span class="s1">&#39;cmdty:id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">commodity</span><span class="o">.</span><span class="n">commodity_id</span>
        <span class="k">return</span> <span class="n">commodity_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_transaction_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_transaction_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_transaction_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">transaction</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current transaction as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current transaction as XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transaction_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:transaction&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">})</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">guid</span>

        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
            <span class="n">transaction_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_commodity_as_short_xml</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="s1">&#39;trn:currency&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">memo</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:num&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">memo</span>

        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">date_posted</span><span class="p">:</span>
            <span class="n">date_posted_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:date-posted&#39;</span><span class="p">)</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">date_posted_node</span><span class="p">,</span> <span class="s1">&#39;ts:date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">safe_iso_date_formatting</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">date_posted</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">date_entered</span><span class="p">:</span>
            <span class="n">date_entered_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:date-entered&#39;</span><span class="p">)</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">date_entered_node</span><span class="p">,</span> <span class="s1">&#39;ts:date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">safe_iso_date_formatting</span><span class="p">(</span>
                <span class="n">transaction</span><span class="o">.</span><span class="n">date_entered</span><span class="p">)</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:description&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">description</span>

        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
            <span class="n">slots_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:slots&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">transaction</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
                <span class="n">slots_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_slot_as_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">splits</span><span class="p">:</span>
            <span class="n">splits_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">transaction_node</span><span class="p">,</span> <span class="s1">&#39;trn:splits&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">transaction</span><span class="o">.</span><span class="n">splits</span><span class="p">:</span>
                <span class="n">splits_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_split_as_xml</span><span class="p">(</span><span class="n">split</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">transaction_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_split_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_split_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_split_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="n">Split</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current split as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current split as XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">split_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;trn:split&#39;</span><span class="p">)</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">guid</span>

        <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">memo</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:memo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">memo</span>
        <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:action&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">action</span>

        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:reconciled-state&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">reconciled_state</span>
        <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">amount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;/100&#39;</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:quantity&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)),</span> <span class="n">split</span><span class="o">.</span><span class="n">quantity_denominator</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">split_node</span><span class="p">,</span> <span class="s1">&#39;split:account&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">guid</span>
        <span class="k">return</span> <span class="n">split_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_scheduled_transaction_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_scheduled_transaction_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_scheduled_transaction_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">scheduled_transaction</span><span class="p">:</span> <span class="n">ScheduledTransaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current scheduled transaction as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current scheduled transaction as XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xml_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:schedxaction&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">guid</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:id&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">guid</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">name</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:enabled&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">enabled</span> <span class="k">else</span> <span class="s1">&#39;n&#39;</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:autoCreate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">auto_create</span> <span class="k">else</span> <span class="s1">&#39;n&#39;</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:autoCreateNotify&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">auto_create_notify</span> \
            <span class="k">else</span> <span class="s1">&#39;n&#39;</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">advance_create_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:advanceCreateDays&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">advance_create_days</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">advance_remind_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:advanceRemindDays&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">advance_remind_days</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">instance_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:instanceCount&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">instance_count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span>
            <span class="n">start_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:start&#39;</span><span class="p">)</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="s1">&#39;gdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">last_date</span><span class="p">:</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:last&#39;</span><span class="p">)</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">last_node</span><span class="p">,</span> <span class="s1">&#39;gdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">last_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
            <span class="n">end_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:end&#39;</span><span class="p">)</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">end_node</span><span class="p">,</span> <span class="s1">&#39;gdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">template_account</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:templ-acct&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">template_account</span><span class="o">.</span><span class="n">guid</span>
        <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_multiplier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                <span class="ow">or</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                <span class="ow">or</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">schedule_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">xml_node</span><span class="p">,</span> <span class="s1">&#39;sx:schedule&#39;</span><span class="p">)</span>
            <span class="n">recurrence_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">schedule_node</span><span class="p">,</span> <span class="s1">&#39;gnc:recurrence&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_multiplier</span><span class="p">:</span>
                <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:mult&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_multiplier</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_period</span><span class="p">:</span>
                <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:period_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_period</span>
            <span class="k">if</span> <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_start</span><span class="p">:</span>
                <span class="n">start_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:start&#39;</span><span class="p">)</span>
                <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="s1">&#39;gdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="n">scheduled_transaction</span><span class="o">.</span><span class="n">recurrence_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xml_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.cast_budget_as_xml">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.cast_budget_as_xml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cast_budget_as_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">budget</span><span class="p">:</span> <span class="n">Budget</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current budget as GnuCash-compatible XML.</span>

<span class="sd">        :return: Current budget as XML</span>
<span class="sd">        :rtype: xml.etree.ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">budget_node</span><span class="p">:</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;gnc:budget&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">})</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">budget_node</span><span class="p">,</span> <span class="s1">&#39;bgt:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;guid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">guid</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">budget_node</span><span class="p">,</span> <span class="s1">&#39;bgt:name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">name</span>
        <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">budget_node</span><span class="p">,</span> <span class="s1">&#39;bgt:description&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">description</span>

        <span class="k">if</span> <span class="n">budget</span><span class="o">.</span><span class="n">period_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">budget_node</span><span class="p">,</span> <span class="s1">&#39;bgt:num-periods&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">budget</span><span class="o">.</span><span class="n">period_count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_multiplier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_period_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> \
                <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recurrence_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">budget_node</span><span class="p">,</span> <span class="s1">&#39;bgt:recurrence&#39;</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_multiplier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:mult&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">budget</span><span class="o">.</span><span class="n">recurrence_multiplier</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_period_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:period_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_period_type</span>
            <span class="k">if</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">recurrence_node</span><span class="p">,</span> <span class="s1">&#39;recurrence:start&#39;</span><span class="p">)</span>
                <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">start_node</span><span class="p">,</span> <span class="s1">&#39;gdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">recurrence_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">budget</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
            <span class="n">slots_node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">budget_node</span><span class="p">,</span> <span class="s1">&#39;bgt:slots&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">budget</span><span class="o">.</span><span class="n">slots</span><span class="p">:</span>
                <span class="n">slots_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">cast_slot_as_xml</span><span class="p">(</span><span class="n">slot</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">budget_node</span></div>


<div class="viewcode-block" id="GnuCashXMLWriter.write_file_contents">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GnuCashXMLWriter.write_file_contents">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_file_contents</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">target_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_contents</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the file contents to the target file.</span>

<span class="sd">        :param target_file: File that contents will be written to.</span>
<span class="sd">        :type target_file: str</span>
<span class="sd">        :param file_contents: Contents to be written to the file.</span>
<span class="sd">        :type file_contents: bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">target_file_handle</span><span class="p">:</span>
            <span class="n">target_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="XMLFileFormat">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.XMLFileFormat">[docs]</a>
<span class="k">class</span> <span class="nc">XMLFileFormat</span><span class="p">(</span><span class="n">GnuCashXMLReader</span><span class="p">,</span> <span class="n">GnuCashXMLWriter</span><span class="p">,</span> <span class="n">BaseFileFormat</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing the logic for loading and saving XML files.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="GZipXMLFileFormat">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GZipXMLFileFormat">[docs]</a>
<span class="k">class</span> <span class="nc">GZipXMLFileFormat</span><span class="p">(</span><span class="n">XMLFileFormat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing the logic for loading and saving XML files with GZip compression.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GZipXMLFileFormat.get_xml_root">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GZipXMLFileFormat.get_xml_root">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_xml_root</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the XML root element from a GZipped XML file.</span>

<span class="sd">        :param source_path: Path to GZipped XML File.</span>
<span class="sd">        :type source_path: str</span>
<span class="sd">        :return: XML root element</span>
<span class="sd">        :rtype: ElementTree.Element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">gzipped_file</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">gzipped_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span></div>


<div class="viewcode-block" id="GZipXMLFileFormat.write_file_contents">
<a class="viewcode-back" href="../../file_formats.html#file_formats.gnucash_xml.GZipXMLFileFormat.write_file_contents">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_file_contents</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">target_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_contents</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the specified contents to the target file, with a level 9 GZip compression.</span>

<span class="sd">        :param target_file: Target GZip file to write to.</span>
<span class="sd">        :type target_file: str</span>
<span class="sd">        :param file_contents: Contents to write to the GZip file</span>
<span class="sd">        :type file_contents: bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="k">as</span> <span class="n">gzip_file</span><span class="p">:</span>
            <span class="n">gzip_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Paul Bromwell Jr..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>